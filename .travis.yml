language: node_js
node_js:
  - 11

dist: trusty
sudo: false
cache: yarn

branches:
  only:
    - production
    - master

jobs:
  include:
    - stage: test
      script: yarn test 
    - stage: deploy
      if: (branch = master) AND (type = push)
      script: yarn report

      if: (branch = production) AND (type = push)
      script: skip
      before_deploy:
        - npm install netlify-cli -g
        - yarn build

      deploy:
        provider: script
        script: netlify deploy -s $NETLIFY_SITE_ID --auth $NETLIFY_PUBLISH_KEY -p --dir ./dist
        skip_cleanup: true
        on:
          branch: production
