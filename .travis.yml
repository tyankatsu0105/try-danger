language: node_js
node_js:
  - 10

dist: trusty
sudo: false
cache: yarn

branches:
  only:
    - production
    - master

jobs:
  - if: (branch = master) AND (type = push)
    script:
      - yarn report

  - if: (branch = production) AND (type = push)
    before_deploy:
      - npm install netlify-cli -g
      - yarn build

    deploy:
      provider: script
      script: netlify deploy -s $NETLIFY_SITE_ID --auth $NETLIFY_PUBLISH_KEY -p --dir ./dist
      skip_cleanup: true
